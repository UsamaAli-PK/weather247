{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}User Analytics - {{ site_title|default:"Django site admin" }}{% endblock %}

{% block extrahead %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    .analytics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .metric-card {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
    }
    
    .metric-value {
        font-size: 2.5em;
        font-weight: bold;
        color: #007cba;
        margin-bottom: 10px;
    }
    
    .metric-label {
        font-size: 1.1em;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    .chart-container {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .chart-title {
        font-size: 1.3em;
        font-weight: bold;
        margin-bottom: 15px;
        color: #333;
    }
</style>
{% endblock %}

{% block content %}
<h1>User Analytics Dashboard</h1>

<div class="analytics-grid">
    <div class="metric-card">
        <div class="metric-value">{{ analytics.total_users }}</div>
        <div class="metric-label">Total Users</div>
    </div>
    
    <div class="metric-card">
        <div class="metric-value">{{ analytics.active_users_24h }}</div>
        <div class="metric-label">Active (24h)</div>
    </div>
    
    <div class="metric-card">
        <div class="metric-value">{{ analytics.active_users_7d }}</div>
        <div class="metric-label">Active (7d)</div>
    </div>
    
    <div class="metric-card">
        <div class="metric-value">{{ analytics.new_users_7d }}</div>
        <div class="metric-label">New Users (7d)</div>
    </div>
    
    <div class="metric-card">
        <div class="metric-value">{{ analytics.verified_users }}</div>
        <div class="metric-label">Verified Users</div>
    </div>
    
    <div class="metric-card">
        <div class="metric-value">{{ analytics.staff_users }}</div>
        <div class="metric-label">Staff Users</div>
    </div>
</div>

<div class="chart-container">
    <div class="chart-title">User Activity Overview</div>
    <canvas id="userActivityChart" width="400" height="200"></canvas>
</div>

<div class="chart-container">
    <div class="chart-title">User Status Distribution</div>
    <canvas id="userStatusChart" width="400" height="200"></canvas>
</div>

<script>
// User Activity Chart
const activityCtx = document.getElementById('userActivityChart').getContext('2d');
new Chart(activityCtx, {
    type: 'bar',
    data: {
        labels: ['Total Users', 'Active (24h)', 'Active (7d)', 'New (7d)'],
        datasets: [{
            label: 'Users',
            data: [
                {{ analytics.total_users }},
                {{ analytics.active_users_24h }},
                {{ analytics.active_users_7d }},
                {{ analytics.new_users_7d }}
            ],
            backgroundColor: [
                'rgba(54, 162, 235, 0.8)',
                'rgba(75, 192, 192, 0.8)',
                'rgba(255, 206, 86, 0.8)',
                'rgba(153, 102, 255, 0.8)'
            ],
            borderColor: [
                'rgba(54, 162, 235, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(153, 102, 255, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});

// User Status Chart
const statusCtx = document.getElementById('userStatusChart').getContext('2d');
new Chart(statusCtx, {
    type: 'doughnut',
    data: {
        labels: ['Verified', 'Unverified', 'Staff', 'Regular'],
        datasets: [{
            data: [
                {{ analytics.verified_users }},
                {{ analytics.total_users|add:"-"|add:analytics.verified_users }},
                {{ analytics.staff_users }},
                {{ analytics.total_users|add:"-"|add:analytics.staff_users }}
            ],
            backgroundColor: [
                'rgba(75, 192, 192, 0.8)',
                'rgba(255, 99, 132, 0.8)',
                'rgba(255, 206, 86, 0.8)',
                'rgba(54, 162, 235, 0.8)'
            ]
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});
</script>

<div style="margin-top: 30px;">
    <a href="{% url 'admin:accounts_user_changelist' %}" class="button">Back to User List</a>
    <a href="{% url 'admin:bulk_operations' %}" class="button">Bulk Operations</a>
</div>
{% endblock %}